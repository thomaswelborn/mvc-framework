(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global = global || self, global.MVC = factory());
}(this, (function () { 'use strict';

  EventTarget.prototype.on=EventTarget.prototype.on||EventTarget.prototype.addEventListener,EventTarget.prototype.off=EventTarget.prototype.off||EventTarget.prototype.removeEventListener;

  class Events{constructor(){}get _events(){return this.events=this.events||{},this.events}getEventCallbacks(a){return this._events[a]||{}}getEventCallbackName(a){return a.name.length?a.name:"anonymousFunction"}getEventCallbackGroup(a,b){return a[b]||[]}on(a,b){var c=this.getEventCallbacks(a),d=this.getEventCallbackName(b),e=this.getEventCallbackGroup(c,d);return e.push(b),c[d]=e,this._events[a]=c,this}off(){switch(arguments.length){case 0:delete this.events;break;case 1:var a=arguments[0];delete this._events[a];break;case 2:var a=arguments[0],b=arguments[1],c="string"==typeof b?b:this.getEventCallbackName(b);this._events[a]&&(delete this._events[a][c],0===Object.keys(this._events[a]).length&&delete this._events[a]);}return this}emit(){var a=Array.from(arguments),b=a.splice(0,1)[0],c=a.splice(0,1)[0],d=a.splice(0);return Object.entries(this.getEventCallbacks(b)).forEach((a)=>{var[e,f]=a;f.forEach(a=>{a({name:b,data:c},...d);});}),this}}

  class Channel{constructor(){}get _responses(){return this.responses=this.responses?this.responses:{},this.responses}response(a,b){return b?void(this._responses[a]=b):this._responses[response]}request(a){if(this._responses[a]){var b=Array.prototype.slice.call(arguments).slice(1);return this._responses[a](...b)}}off(a){if(a)delete this._responses[a];else for(var[b]of Object.keys(this._responses))delete this._responses[b];}}

  class Channels{constructor(){}get _channels(){return this.channels=this.channels?this.channels:{},this.channels}channel(a){return this._channels[a]=this._channels[a]?this._channels[a]:new Channel,this._channels[a]}off(a){delete this._channels[a];}}

  function UUID(){var a,b,c="";for(a=0;32>a;a++)b=0|16*Math.random(),(8==a||12==a||16==a||20==a)&&(c+="-"),c+=(12==a?4:16==a?8|3&b:b).toString(16);return c}



  var Utilities$1 = /*#__PURE__*/Object.freeze({
    __proto__: null,
    UUID: UUID
  });

  class Service extends Events{constructor(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(...arguments),this.settings=a,this.options=b;}get validSettings(){return ["url","method","mode","cache","credentials","headers","parameters","redirect","referrer-policy","body"]}get settings(){return this._settings}set settings(a){this._settings=a,this.validSettings.forEach(b=>{a[b]&&(this[b]=a[b]);});}get options(){return this._options||(this._options={}),this._options}set options(a){this._options=a;}get url(){return this.parameters?this._url.concat(this.queryString):this._url}set url(a){this._url=a;}get queryString(){var a="";if(this.parameters){var b=Object.entries(this.parameters).reduce((a,b)=>{var[c,d]=b,e=c.concat("=",d);return a.push(e),a},[]).join("&");a="?".concat(b);}return a}get method(){return this._method}set method(a){this._method=a;}set mode(a){this._mode=a;}get mode(){return this._mode}set cache(a){this._cache=a;}get cache(){return this._cache}set credentials(a){this._credentials=a;}get credentials(){return this._credentials}set headers(a){this._headers=a;}get headers(){return this._headers}set redirect(a){this._redirect=a;}get redirect(){return this._redirect}set referrerPolicy(a){this._referrerPolicy=a;}get referrerPolicy(){return this._referrerPolicy}set body(a){this._body=a;}get body(){return this._body}get parameters(){return this._parameters||null}set parameters(a){this._parameters=a;}get previousAbortController(){return this._previousAbortController}set previousAbortController(a){this._previousAbortController=a;}get abortController(){return this._abortController||(this.previousAbortController=this._abortController),this._abortController=new AbortController,this._abortController}abort(){return this.abortController.abort(),this}fetch(){var a=this.validSettings.reduce((a,b)=>(this[b]&&(a[b]=this[b]),a),{});return a.signal=this.abortController.signal,this.previousAbortController&&this.previousAbortController.abort(),fetch(this.url,a).then(a=>a.json()).then(a=>(this.emit("ready",{data:a}),a)).catch(a=>{var b={type:"error",message:a};return this.emit("error",{data:b}),b})}}

  var Model=class extends Events{constructor(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(),this.settings=a,this.options=b,this.emit("ready",{},this);}get uuid(){return this._uuid||(this._uuid=UUID()),this._uuid}get validSettings(){return ["localStorage","defaults","services","serviceEvents","serviceCallbacks"]}get bindableEventClassPropertyTypes(){return ["service"]}get settings(){return this._settings}set settings(a){this._settings=a,this.validSettings.forEach(b=>{a[b]&&(this[b]=a[b]);}),this.bindableEventClassPropertyTypes.forEach(a=>{this.toggleEvents(a,"on");});}get options(){return this._options||(this._options={}),this._options}set options(a){this._options=a;}get services(){return this._services||(this._services={}),this._services}set services(a){this._services=a;}get data(){return this._data||(this._data={}),this._data}get defaults(){return this._defaults||(this._defaults={}),this._defaults}set defaults(a){this._defaults=!0===this.localStorage.sync?0===Object.entries(this.db).length?a:this.db:a,this.set(this.defaults);}get localStorage(){return this._localStorage||{}}set localStorage(a){this._localStorage=a;}get storageContainer(){return {}}get db(){return this._db}get _db(){var a=localStorage.getItem(this.localStorage.endpoint)||JSON.stringify(this.storageContainer);return JSON.parse(a)}set _db(a){a=JSON.stringify(a),localStorage.setItem(this.localStorage.endpoint,a);}resetEvents(a){return ["off","on"].forEach(b=>{this.toggleEvents(a,b);}),this}toggleEvents(a,b){var c=a.concat("s"),d=a.concat("Events"),e=a.concat("Callbacks"),f=this[c],g=this[d],h=this[e];return f&&g&&h&&Object.entries(g).forEach((a)=>{var[c,d]=a,[e,g]=c.split(" "),i=f[e],j=h[d];if(e&&g&&i&&j)try{classTypeTarget[b](classTypeEventName,classTypeEventCallback);}catch(a){}}),this}setDB(){var a=this._db;switch(arguments.length){case 1:var b=Object.entries(arguments[0]);b.forEach((b)=>{var[c,d]=b;a[c]=d;});break;case 2:var c=arguments[0],d=arguments[1];a[c]=d;}return this._db=a,this}unsetDB(){switch(arguments.length){case 0:delete this._db;break;case 1:var a=this._db,b=arguments[0];delete a[b],this._db=a;}return this}setDataProperty(a,b,c){return this.data[a]||Object.defineProperties(this.data,{["_".concat(a)]:{configurable:!0,writable:!0,enumerable:!1},[a]:{configurable:!0,enumerable:!0,get(){return this["_".concat(a)]},set(b){this["_".concat(a)]=b;}}}),this.data[a]=b,("undefined"==typeof c||!1===c||"undefined"==typeof c)&&this.emit("set".concat(":",a),{key:a,value:b},this),this}unsetDataProperty(a,b){return this.data[a]&&delete this.data[a],("boolean"==typeof b&&!1===b||"undefined"==typeof b)&&this.emit("unset".concat(":",arguments[0]),this),this}get(){return arguments[0]?this.data[arguments[0]]:Object.entries(this.data).reduce((a,b)=>{var[c,d]=b;return a[c]=d,a},{})}set(){var a,b,c;return 3===arguments.length?(a=arguments[0],b=arguments[1],c=arguments[2],this.setDataProperty(a,b,c)):2===arguments.length?("string"==typeof arguments[0]&&"boolean"==typeof arguments[1]?(c=arguments[1],Object.entries(arguments[0]).forEach((a)=>{var[b,d]=a;this.setDataProperty(b,d,c);})):this.setDataProperty(arguments[0],arguments[1]),this.localStorage&&this.setDB(arguments[0],arguments[1])):1===arguments.length&&!Array.isArray(arguments[0])&&"object"==typeof arguments[0]&&Object.entries(arguments[0]).forEach((a)=>{var[b,c]=a;this.setDataProperty(b,c),this.localStorage&&this.setDB(b,c);}),this.emit("set",this.data,this),this}unset(){var a;return 2===arguments.length?(a=arguments[1],this.unsetDataProperty(arguments[0],a)):1===arguments.length?"boolean"==typeof arguments[0]&&(a=arguments[0],Object.keys(this.data).forEach(b=>{this.unsetDataProperty(b,a);})):Object.keys(this.data).forEach(a=>{this.unsetDataProperty(a);}),this.localStorage&&this.unsetDB(key),this.emit("unset",this),this}parse(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.data;return Object.entries(a).reduce((a,b)=>{var[c,d]=b;return a[c]=d instanceof Model?d.parse():d,a},{})}};

  class Collection extends Events{constructor(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(),this.settings=a,this.options=b;}get validSettings(){return ["idAttribute","model","defaults","services","serviceEvents","serviceCallbacks","localStorage"]}get bindableEventClassPropertyTypes(){return ["service"]}get settings(){return this._settings}set settings(a){this._settings=a,this.validSettings.forEach(b=>{a[b]&&(this[b]=a[b]);}),this.bindableEventClassPropertyTypes.forEach(a=>{this.toggleEvents(a,"on");});}get options(){return this._options||(this._options={}),this._options}set options(a){this._options=a;}get storageContainer(){return []}get defaultIDAttribute(){return "_id"}get defaults(){return this._defaults}set defaults(a){this._defaults=a,this.add(a);}get uuid(){return this._uuid||(this._uuid=Utilities.UUID()),this._uuid}get models(){return this._models=this._models||this.storageContainer,this._models}set models(a){this._models=a;}get model(){return this._model}set model(a){this._model=a;}get localStorage(){return this._localStorage}set localStorage(a){this._localStorage=a;}get data(){return this._data}get data(){return this._models.map(a=>a.parse())}get db(){return this._db}get db(){var a=localStorage.getItem(this.localStorage.endpoint)||JSON.stringify(this.storageContainer);return JSON.parse(a)}set db(a){a=JSON.stringify(a),localStorage.setItem(this.localStorage.endpoint,a);}resetEvents(a){return ["off","on"].forEach(b=>{this.toggleEvents(a,b);}),this}toggleEvents(a,b){var c=a.concat("s"),d=a.concat("Events"),e=a.concat("Callbacks"),f=this[c],g=this[d],h=this[e];return f&&g&&h&&Object.entries(g).forEach((a)=>{var[c,d]=a,[e,g]=c.split(" "),i=f[e],j=h[d];if(e&&g&&i&&j)try{classTypeTarget[b](classTypeEventName,classTypeEventCallback);}catch(a){}}),this}getModelIndex(a){var b;return this._models.find((c,d)=>{if(null!==c&&c instanceof Model&&c._uuid===a)return b=d,c}),b}removeModelByIndex(a){var b=this._models.splice(a,1,null);return this.emit("remove:model",b[0].parse(),this,b[0]),this}addModel(a){var b,c=new Model;return a instanceof Model?b=a:this.model?(b=new this.model,b.set(a)):(b=new Model,b.set(a)),b.on("set",()=>{this.emit("change:model",this.parse(),this,b);}),this.models.push(b),this.emit("add",b.parse(),this,b),b}add(a){return Array.isArray(a)?a.forEach(a=>{this.addModel(a);}):this.addModel(a),this.localStorage&&(this.db=this.data),this.emit("change",this.parse(),this),this}remove(a){if(!Array.isArray(a)&&"object"==typeof a){var b=this.getModelIndex(a.uuid);this.removeModelByIndex(b);}else Array.isArray(a)&&a.forEach(a=>{var b=this.getModelIndex(a.uuid);this.removeModelByIndex(b);});return this.models=this.models.filter(a=>null!==a),this._localStorage&&(this.db=this.data),this.emit("remove",this.parse(),this),this}reset(){return this.remove(this._models),this}parse(a){return a=a||this.data||this.storageContainer,JSON.parse(JSON.stringify(a))}}

  class View extends Events{constructor(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(),this.settings=a,this.options=b;}get validSettings(){return ["attributes","elementName","element","insert","template","uiElements","uiElementEvents","uiElementCallbacks","render"]}get settings(){return this._settings}set settings(a){this._settings=a,this.validSettings.forEach(b=>{a[b]&&(this[b]=a[b]);});}get options(){return this._options||(this._options={}),this._options}set options(a){this._options=a;}get elementName(){return this._elementName}set elementName(a){this._elementName=a;}get element(){return this._element||(this._element=document.createElement(this.elementName),Object.entries(this.attributes).forEach((a)=>{var[b,c]=a;this._element.setAttribute(b,c);}),this.elementObserver.observe(this.element,{subtree:!0,childList:!0})),this._element}get elementObserver(){return this._elementObserver=this._elementObserver||new MutationObserver(this.elementObserve.bind(this)),this._elementObserver}set element(a){a instanceof HTMLElement&&(this._element=a);}get attributes(){return this._attributes||{}}set attributes(a){this._attributes=a;}get template(){return this._template}set template(a){this._template=a;}get uiElements(){return this._uiElements||{}}set uiElements(a){this._uiElements=a,this.toggleEvents();}get uiElementEvents(){return this._uiElementEvents||{}}set uiElementEvents(a){this._uiElementEvents=a,this.toggleEvents();}get uiElementCallbacks(){return this._uiElementCallbacks||{}}set uiElementCallbacks(a){this._uiElementCallbacks=a,this.toggleEvents();}get ui(){var a=this;return this._ui||(this._ui=Object.entries(this.uiElements).reduce((b,c)=>{var[d,e]=c;return Object.defineProperties(b,{[d]:{get(){if("string"==typeof e){var b=a.element.querySelectorAll(e);return 1<b.length?b:b.item(0)}return e instanceof HTMLElement||e instanceof Document||e instanceof Window?e:void 0}}}),b},{}),Object.defineProperties(this._ui,{$element:{get(){return a.element}}})),this._ui}elementObserve(a,b){var c=this,d=function(a,b){switch(b.type){case"childList":b.addedNodes.length&&Object.entries(Object.getOwnPropertyDescriptors(c.ui)).forEach((a)=>{var[d,e]=a,f=e.get(),g=Array.from(b.addedNodes).find(a=>a===f);g&&c.toggleEvents(d);});}};for(var[e,f]of Object.entries(a))d(e,f);}bindEventToElement(a,b,c,d){try{"addEventListener"===b?(this.uiElementCallbacks[d]=this.uiElementCallbacks[d].bind(this),a[b](c,this.uiElementCallbacks[d])):"removeEventListener"===b?a[b](c,this.uiElementCallbacks[d]):void 0;}catch(a){}}toggleEvents(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.isToggling=!0;var b=this.ui,c=["removeEventListener","addEventListener"];return a?c.forEach(c=>{Object.entries(this.uiElementEvents).forEach((d)=>{var[e,f]=d,[g,h]=e.split(" ");a===g&&(b[g]instanceof NodeList?b[g].forEach(a=>{this.bindEventToElement(a,c,h,f);}):b[g]instanceof HTMLElement&&this.bindEventToElement(b[g],c,h,f));});}):c.forEach(a=>{Object.entries(this.uiElementEvents).forEach((c)=>{var[d,e]=c,[f,g]=d.split(" ");b[f]instanceof NodeList?b[f].forEach(b=>{this.bindEventToElement(b,a,g,e);}):(b[f]instanceof HTMLElement||b[f]instanceof Document||b[f]instanceof Window)&&this.bindEventToElement(b[f],a,g,e);});}),this.isToggling=!1,this}autoInsert(){if(this.insert){var a="string"==typeof this.insert.parent?document.querySelector(this.insert.parent):this.insert.parent instanceof HTMLElement?this.insert.parent:null,b=this.insert.method;a.insertAdjacentElement(b,this.element);}return this}autoRemove(){return this.element.parentElement&&this.element.parentElement.removeChild(this.element),this}render(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(this.template){var b=this.template(a);this.element.innerHTML=b;}return this.toggleEvents(),this}}

  var Controller=class extends Events{constructor(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(),this.settings=a,this.options=b;}get validSettings(){return ["models","modelEvents","modelCallbacks","collections","collectionEvents","collectionCallbacks","views","viewEvents","viewCallbacks","controllers","controllerEvents","controllerCallbacks","routers","routerEvents","routerCallbacks"]}get bindableEventClassPropertyTypes(){return ["model","view","collection","controller","router"]}get options(){return this._options||(this._options={}),this._options}set options(a){this._options=a;}get settings(){return this._settings||(this._settings={}),this._settings}set settings(a){this._settings=a,this.validSettings.forEach(a=>{this.settings[a]&&(Object.defineProperties(this,{["_".concat(a)]:{configurable:!0,writable:!0,enumberable:!1},[a]:{configurable:!0,enumerable:!0,get(){return this["_".concat(a)]},set(b){this["_".concat(a)]=b;}}}),this[a]=this.settings[a]);}),this.bindableEventClassPropertyTypes.forEach(a=>{this.resetEvents(a);});}resetEvents(a){return ["off","on"].forEach(b=>{this.toggleEvents(a,b);}),this}toggleEvents(a,b){var c=a.concat("s"),d=a.concat("Events"),e=a.concat("Callbacks"),f=this[c]||{},g=this[d]||{},h=this[e]||{};return Object.values(f).length&&Object.values(g).length&&Object.values(h).length&&Object.entries(g).forEach((a)=>{var[c,d]=a,[e,g]=c.split(" "),i=e.substring(0,1),j=e.substring(e.length-1),k=[];"["===i&&"]"===j?k=Object.entries(f).reduce((a,b)=>{var[c,d]=b,f=e.slice(1,-1),g=new RegExp(f);return c.match(g)&&a.push(d),a},[]):f[e]&&k.push(f[e]);var l=h[d];l&&1===l.name.split(" ").length&&(l=l.bind(this)),e&&g&&k.length&&l&&k.forEach(a=>{try{"on"===b?a[b](g,l):"off"===b?a[b](g,l):void 0;}catch(a){throw a}});}),this}};

  var Router=class extends Events{constructor(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(),this.settings=a,this.options=b,this.addSettings(),this.addWindowEvents();}get validSettings(){return ["root","hashRouting","controller","routes"]}get settings(){return this._settings}set settings(a){this._settings=a,this.validSettings.forEach(b=>{a[b]&&(this[b]=a[b]);});}get options(){return this._options||(this._options={}),this._options}set options(a){this._options=a;}get protocol(){return window.location.protocol}get hostname(){return window.location.hostname}get port(){return window.location.port}get pathname(){return window.location.pathname}get path(){var a=window.location.pathname.replace(new RegExp(["^",this.root].join("")),"").split("?").slice(0,1)[0],b=0===a.length?[]:1===a.length&&a.match(/^\//)&&a.match(/\/?/)?["/"]:a.replace(/^\//,"").replace(/\/$/,"").split("/");return {fragments:b,string:a}}get hash(){var a=window.location.hash.slice(1).split("?").slice(0,1)[0],b=0===a.length?[]:1===a.length&&a.match(/^\//)&&a.match(/\/?/)?["/"]:a.replace(/^\//,"").replace(/\/$/,"").split("/");return {fragments:b,string:a}}get parameters(){var a,b;if(window.location.href.match(/\?/)){var c=window.location.href.split("?").slice(-1).join("");a=c,b=c.split("&").reduce((a,b)=>{var c=b.split("=");return a[c[0]]=c[1],a},{});}else a="",b={};return {string:a,data:b}}get _root(){return this.root||"/"}set _root(a){this.root=a;}get _hashRouting(){return this.hashRouting||!1}set _hashRouting(a){this.hashRouting=a;}get _routes(){return this.routes}set _routes(a){this.routes=a;}get _controller(){return this.controller}set _controller(a){this.controller=a;}get location(){return {root:this.root,path:this.path,hash:this.hash,parameters:this.parameters}}matchRoute(a,b){var c=[];return a.length===b.length?c=a.reduce((a,c,d)=>{var e=b[d];return c.match(/^\:/)?a.push(!0):c===e?a.push(!0):a.push(!1),a},[]):c.push(!1),-1===c.indexOf(!1)}getRoute(a){var b=Object.entries(this.routes).reduce((a,b)=>{var[c,d]=b,e=1===c.length&&c.match(/^\//)?[c]:0===c.length?[""]:c.replace(/^\//,"").replace(/\/$/,"").split("/");return d.fragments=e,a[e.join("/")]=d,a},{});return Object.values(b).find(b=>{var c=b.fragments,d=this.hashRouting?a.hash.fragments:a.path.fragments,e=this.matchRoute(c,d);return !0===e})}popState(a){var b=this.location,c=this.getRoute(b),d={route:c,location:b};c&&(this.controller[c.callback](d),this.emit("change",{name:"change",data:d},this));}addWindowEvents(){window.on("popstate",this.popState.bind(this));}removeWindowEvents(){window.off("popstate",this.popState.bind(this));}navigate(a){window.location.href=a;}};

  var MVC={Events,Channels,Utilities: Utilities$1,Service,Model,Collection,View,Controller,Router};

  return MVC;

})));

(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global = global || self, global.MVC = factory());
}(this, (function () { 'use strict';

  EventTarget.prototype.on=EventTarget.prototype.on||EventTarget.prototype.addEventListener,EventTarget.prototype.off=EventTarget.prototype.off||EventTarget.prototype.removeEventListener;

  class Events{constructor(){}get _events(){return this.events=this.events||{},this.events}getEventCallbacks(a){return this._events[a]||{}}getEventCallbackName(a){return a.name.length?a.name:"anonymousFunction"}getEventCallbackGroup(a,b){return a[b]||[]}on(a,b){var c=this.getEventCallbacks(a),d=this.getEventCallbackName(b),e=this.getEventCallbackGroup(c,d);return e.push(b),c[d]=e,this._events[a]=c,this}off(){switch(arguments.length){case 0:delete this.events;break;case 1:var a=arguments[0];delete this._events[a];break;case 2:var a=arguments[0],b=arguments[1],c="string"==typeof b?b:this.getEventCallbackName(b);this._events[a]&&(delete this._events[a][c],0===Object.keys(this._events[a]).length&&delete this._events[a]);}return this}emit(){var a=Array.from(arguments),b=a.splice(0,1)[0],c=a.splice(0,1)[0],d=a.splice(0);return Object.entries(this.getEventCallbacks(b)).forEach((a)=>{var[e,f]=a;f.forEach(a=>{a({name:b,data:c},...d);});}),this}}

  class Channel{constructor(){}get _responses(){return this.responses=this.responses?this.responses:{},this.responses}response(a,b){return b?void(this._responses[a]=b):this._responses[response]}request(a){if(this._responses[a]){var b=Array.prototype.slice.call(arguments).slice(1);return this._responses[a](...b)}}off(a){if(a)delete this._responses[a];else for(var[b]of Object.keys(this._responses))delete this._responses[b];}}

  class Channels{constructor(){}get _channels(){return this.channels=this.channels?this.channels:{},this.channels}channel(a){return this._channels[a]=this._channels[a]?this._channels[a]:new Channel,this._channels[a]}off(a){delete this._channels[a];}}

  function UUID(){var a,b,c="";for(a=0;32>a;a++)b=0|16*Math.random(),(8==a||12==a||16==a||20==a)&&(c+="-"),c+=(12==a?4:16==a?8|3&b:b).toString(16);return c}



  var Utils = /*#__PURE__*/Object.freeze({
    __proto__: null,
    UUID: UUID
  });

  class Base extends Events{constructor(a,b){super(),this._configuration=b||{},this._settings=a||{},this.addBindableClassProperties(),this.addClassDefaultProperties();}get _uuid(){return this.uuid=this.uuid||MVC.Utils.UUID(),this.uuid}get _name(){return this.name}set _name(a){this.name=a;}get _settings(){return this.settings=this.settings||{},this.settings}set _settings(a){this.settings=a;var b=this.classDefaultProperties||[];b=b.concat(this.getBindableClassPropertiesNames()),Object.entries(this.settings).forEach((a)=>{var[c,d]=a;-1===b.indexOf(c)&&(Object.defineProperty(this,["_".concat(c)],{get:function get(){return this[c]},set:function set(a){this[c]=a;}}),this["_".concat(c)]=d);});}get _configuration(){return this.configuration=this.configuration||{},this.configuration}set _configuration(a){this.configuration=a;}get _uiElementSettings(){return this.uiElementSettings=this.uiElementSettings||{},this.uiElementSettings}set _uiElementSettings(a){this.uiElementSettings=a;}getBindableClassPropertiesNames(){return this.bindableClassProperties?this.bindableClassProperties.reduce((a,b)=>(a=a.concat(this.getBindableClassPropertyNames(b)),a),[]):[]}getBindableClassPropertyNames(a){return "data"===a?[a.concat(""),a.concat("Events"),a.concat("Callbacks")]:[a.concat("s"),a.concat("Events"),a.concat("Callbacks")]}capitalizePropertyName(a){if("ui"===a.slice(0,2))return a.replace(/^ui/,"UI");var b=a.substring(0,1).toUpperCase();return a.replace(/^./,b)}addClassDefaultProperties(){return this.classDefaultProperties.forEach(a=>{var b=this.settings[a]||this[a];b&&(Object.defineProperty(this,a,{writable:!0}),this["_".concat(a)]=b);}),this}addBindableClassProperties(){return this.bindableClassProperties&&this.bindableClassProperties.forEach(a=>{var b=this.getBindableClassPropertyNames(a);b.forEach((c,d)=>{this.addBindableClassProperty(c),d===b.length-1&&this.toggleTargetBindableClassEvents(a,"on");});}),this}addBindableClassProperty(a){var b=this,c=this.capitalizePropertyName(a),d="add".concat(c),e="remove".concat(c);"uiElements"===a&&(b._uiElementSettings=this[a]);var f=this.settings[a]||this[a];return Object.defineProperties(this,{[a]:{writable:!0,value:f},["_".concat(a)]:{get:function get(){return b[a]=b[a]||{},b[a]},set:function set(c){var d=Object.entries(c);d.forEach((c,e)=>{var[f,g]=c;"uiElements"===a?(b._uiElementSettings[f]=g,Object.defineProperty(b["_".concat(a)],[f],{get:function get(){return b.element?b.element.querySelectorAll(g):null}}),e===d.length-1&&Object.defineProperty(b["_".concat(a)],"$element",{configurable:!0,get:function get(){if(b.element)return b.element}})):b["_".concat(a)][f]=g;});}},[d]:{value:function(){if(2===arguments.length){var c=arguments[0],d=arguments[1];b["_".concat(a)]={[c]:d};}else if(1===arguments.length){var e=arguments[0];b["_".concat(a)]=e;}return this.resetTargetBindableClassEvents(a),b}},[e]:{value:function value(){if(1===arguments.length){var c=arguments[0];"uiElements"===a?(delete b["_".concat(a)][c],delete b["_".concat("uiElementSettings")][c]):delete b["_".concat(a)][c];}else 0===arguments.length&&Object.keys(b["_".concat(a)]).forEach(c=>{"uiElements"===a?(delete b["_".concat(a)][c],delete b["_".concat("uiElementSettings")][c]):delete b["_".concat(a)][c];});return this.resetTargetBindableClassEvents(a),b}}}),f&&this[d](f),this}resetTargetBindableClassEvents(a){return this.toggleTargetBindableClassEvents(a,"off").toggleTargetBindableClassEvents(a,"on")}toggleTargetBindableClassEvents(a,b){return this[a.concat("s")]&&this[a.concat("Events")]&&this[a.concat("Callbacks")]&&Object.entries(this[a.concat("Events")]).forEach((c)=>{var[d,e]=c;d=d.split(" ");var f=d[0],g=d[1],h=this[a.concat("s")][f],i="uiElement"===a?this[a.concat("Callbacks")][e]:this[a.concat("Callbacks")][e].bind(this);f&&g&&h&&i&&this.toggleTargetBindableClassEvent(a,h,g,i,b);}),this}toggleTargetBindableClassEvent(a,b,c,d,e){switch(e){case"on":switch(a){case"uiElement":b instanceof NodeList?Array.from(b).forEach(a=>{a[e](c,d);}):b instanceof HTMLElement&&b[e](c,d);break;default:b[e](c,d);}break;case"off":switch(a){case"uiElement":b instanceof NodeList?Array.from(b).forEach(a=>{a[e](c,d);}):b instanceof HTMLElement&&b[e](c,d);break;default:b[e](c,d);}}}}

  class Service extends Base{constructor(){super(...arguments);}get classDefaultProperties(){return ["responseType","type","parameters","url","headers","data"]}get _defaults(){return this.defaults||{contentType:{"Content-Type":"application/json"},responseType:"json"}}get _async(){return this.async=this.async||!0,this.async}set _async(a){this.async=a;}get _responseTypes(){return ["","arraybuffer","blob","document","json","text"]}get _responseType(){return this.responseType}set _responseType(a){this._xhr.responseType=this._responseTypes.find(b=>b===a)||this._defaults.responseType;}get _type(){return this.type=this.type||!0,this.type}set _type(a){this.type=a;}get _parameters(){return this.parameters=this.parameters||{},this.parameters}set _parameters(a){this.parameters=a;}get _url(){return this.url}set _url(a){this.url=a;}get _headers(){return this.headers=this.headers||[this._defaults.contentType],this.headers}set _headers(a){this.headers=a;}get _data(){return this.data=this.data||{},this.data}set _data(a){this.data=a;}get _xhr(){return this.xhr=this.xhr?this.xhr:new XMLHttpRequest,this.xhr}stringParameters(){var a=Object.entries(this._parameters);return a.length?a.reduce((b,c,d)=>{var[e,f]=c,g=d===a.length-1?"":"&";return b=b.concat(e,"=",f,g),b},"?"):""}request(){var a=this._type,b=Object.keys(this._parameters).length?this._url.concat(this.stringParameters()):this._url,c=this._async,d=this._xhr;return new Promise((e,f)=>{d.onload=e,d.onerror=f,d.open(a,b,c),this._headers.forEach(a=>{a=Object.entries(a)[0],d.setRequestHeader(a[0],a[1]);}),Object.keys(this._data).length?d.send(this._data):d.send();}).then(a=>(this.emit("xhrResolve",{name:"xhrResolve",data:a.currentTarget},this),a)).catch(a=>{throw a})}}

  class Model extends Base{constructor(){super(...arguments);}get storageContainer(){return {}}get defaultIDAttribute(){return "_id"}get bindableClassProperties(){return ["service"]}get classDefaultProperties(){return ["idAttribute","localStorage","histiogram","defaults"]}get _idAttribute(){return this.idAttribute=this.idAttribute||this.defaultIDAttribute,this.idAttribute}set _idAttribute(a){this.idAttribute=a;}get _defaults(){return this.defaults}set _defaults(a){this.defaults=a,this.set(this.defaults);}get _isSetting(){return this.isSetting}set _isSetting(a){this.isSetting=a;}get _silent(){return this.silent="boolean"==typeof this.silent&&this.silent,this.silent}set _silent(a){this.silent=a;}get _changing(){return this.changing=this.changing||{},this.changing}get _localStorage(){return this.localStorage}set _localStorage(a){this.localStorage=a;}get _histiogram(){return this.histiogram||{length:1}}set _histiogram(a){this.histiogram=Object.assign(this._histiogram,a);}get _history(){return this.history=this.history||[],this.history}set _history(a){Object.keys(a).length&&this._histiogram.length&&(this._history.unshift(this.parse(a)),this._history.splice(this._histiogram.length));}get _data(){return this.data=this.data||this.storageContainer,this.data}set _data(a){this.data=a;}get db(){return this._db}get _db(){var a=localStorage.getItem(this.localStorage.endpoint)||JSON.stringify(this.storageContainer);return JSON.parse(a)}set _db(a){a=JSON.stringify(a),localStorage.setItem(this.localStorage.endpoint,a);}get(){switch(arguments.length){case 0:return Object.assign({},this._data);case 1:var a=arguments[0];return this._data[a];}}set(){switch(this._history=this.parse(),arguments.length){case 1:this._isSetting=!0;var a=Object.entries(arguments[0]);a.forEach((b,c)=>{var[d,e]=b;this._isSetting=c!==a.length-1,this.setDataProperty(d,e);});break;case 2:if("string"==typeof arguments[0]){var b=arguments[0],c=arguments[1];this.setDataProperty(b,c);}else{var a=Object.entries(arguments[0]),d=arguments[1];a.forEach((b,c)=>{var[e,f]=b;this._isSetting=c!==a.length-1,this._silent=d,this.setDataProperty(e,f),this._silent=!1;});}break;case 3:var b=arguments[0],c=arguments[1],d=arguments[2];this._silent=d,this.setDataProperty(b,c),this._silent=!1;}return this}unset(){switch(this._history=this.parse(),arguments.length){case 0:for(var a of Object.keys(this._data))this.unsetDataProperty(a);break;case 1:var b=arguments[0];this.unsetDataProperty(b);}return this}setDB(){var a=this._db;switch(arguments.length){case 1:var b=Object.entries(arguments[0]);b.forEach((b)=>{var[c,d]=b;a[c]=d;});break;case 2:var c=arguments[0],d=arguments[1];a[c]=d;}return this._db=a,this}unsetDB(){switch(arguments.length){case 0:delete this._db;break;case 1:var a=this._db,b=arguments[0];delete a[b],this._db=a;}return this}setDataProperty(a,b){if(!this._data["_".concat(a)]){var c=this;Object.defineProperties(this._data,{["_".concat(a)]:{configurable:!0,get(){return this[a]},set(b){this[a]=b,c._changing[a]=b,c.localStorage&&c.setDB(a,b);var d=["set",":",a].join(""),e="set";!0!==c.silent&&c.emit(d,{name:d,data:{key:a,value:b}},c),c._isSetting||(Object.values(c._changing).length?!0!==c.silent&&c.emit(e,{name:e,data:Object.assign({},c._changing,c._data)},c):!0!==c.silent&&c.emit(e,{name:e,data:Object.assign({},c._data)},c),delete c.changing);}}});}return this._data["_".concat(a)]=b,this}unsetDataProperty(a){var b=["unset",":",a].join(""),c="unset",d=this._data[a];return delete this._data["_".concat(a)],delete this._data[a],this.emit(b,{name:b,data:{key:a,value:d}},this),this.emit(c,{name:c,data:{key:a,value:d}},this),this}parse(a){return a=a||this._data||this.storageContainer,JSON.parse(JSON.stringify(a))}}

  class Collection extends Base{constructor(){super(...arguments);}get storageContainer(){return []}get defaultIDAttribute(){return "_id"}get bindableClassProperties(){return ["service"]}get classDefaultProperties(){return ["idAttribute","model","defaults"]}get _idAttribute(){return this.idAttribute=this.idAttribute||this.defaultIDAttribute,this.idAttribute}set _idAttribute(a){this.idAttribute=a;}get _defaults(){return this.defaults}set _defaults(a){this.defaults=a,this.set(a);}get _models(){return this.models=this.models||this.storageContainer,this.models}set _models(a){this.models=a;}get _model(){return this.model}set _model(a){this.model=a;}get _isSetting(){return this.isSetting}set _isSetting(a){this.isSetting=a;}get _localStorage(){return this.localStorage}set _localStorage(a){this.localStorage=a;}get data(){return this._data}get _data(){return this._models.map(a=>a.parse())}get db(){return this._db}get _db(){var a=localStorage.getItem(this._localStorage.endpoint)||JSON.stringify(this.storageContainer);return JSON.parse(a)}set _db(a){a=JSON.stringify(a),localStorage.setItem(this._localStorage.endpoint,a);}getModelIndex(a){var b;return this._models.find((c,d)=>{if(null!==c&&c instanceof Model&&c._uuid===a)return b=d,c}),b}removeModelByIndex(a){var b=this._models.splice(a,1,null);return this.emit("remove",{name:"remove"},b[0],this),this}addModel(a){var b;return a instanceof Model&&(b=a,b.on("set",()=>{this.emit("change",{name:"change"},this);}),this._models.push(b)),this.emit("add",{name:"add"},b,this),this}add(a){return this._isSetting=!0,Array.isArray(a)?a.forEach(a=>{this.addModel(a);}):this.addModel(a),this._localStorage&&(this._db=this._data),this._isSetting=!1,this.emit("change",{name:"change",data:this._data},this),this}remove(a){if(this._isSetting=!0,!Array.isArray(a)){var b=this.getModelIndex(a._uuid);this.removeModelByIndex(b);}else Array.isArray(a)&&a.forEach(a=>{var b=this.getModelIndex(a._uuid);this.removeModelByIndex(b);});return this._models=this._models.filter(a=>null!==a),this._localStorage&&(this._db=this._data),this._isSetting=!1,this.emit("change",{name:"change",data:this._data},this),this}reset(){return this.remove(this._models),this}parse(a){return a=a||this._data||this.storageContainer,JSON.parse(JSON.stringify(a))}}

  class View extends Base{constructor(){super(...arguments);}get bindableClassProperties(){return ["uiElement"]}get classDefaultProperties(){return ["elementName","element","attributes","templates","insert"]}get _elementName(){return this._element.tagName}set _elementName(a){this._element||(this._element=document.createElement(a));}get _element(){return this.element}set _element(a){this.element=a,this.elementObserver.observe(this.element,{subtree:!0,childList:!0});}get _attributes(){return this.attributes=this.element.attributes,this.attributes}set _attributes(a){for(var[b,c]of Object.entries(a))"undefined"==typeof c?this._element.removeAttribute(b):this._element.setAttribute(b,c);}get elementObserver(){return this._elementObserver=this._elementObserver||new MutationObserver(this.elementObserve.bind(this)),this._elementObserver}get _insert(){return this.insert=this.insert||null,this.insert}set _insert(a){this.insert=a;}get _templates(){return this.templates=this.templates||{},this.templates}set _templates(a){this.templates=a;}elementObserve(a,b){for(var[c,d]of Object.entries(a))switch(d.type){case"childList":this.resetTargetBindableClassEvents("uiElement"),d.addedNodes.length&&this.addedNodes&&this.addedNodes(),d.removedNodes.length&&this.removedNodes&&this.removedNodes();}}autoInsert(){var a=this.insert;return a.parent.insertAdjacentElement(a.method,this._element),this}autoRemove(){return this.element&&this.element.parentElement&&this.element.parentElement.removeChild(this.element),this}}

  var Controller=class extends Base{constructor(){super(...arguments);}get bindableClassProperties(){return ["model","collection","view","controller","router"]}get classDefaultProperties(){return []}};

  var Router=class extends Base{constructor(){super(...arguments),this.addWindowEvents();}get classDefaultProperties(){return ["root","hashRouting","controller","routes"]}get protocol(){return window.location.protocol}get hostname(){return window.location.hostname}get port(){return window.location.port}get pathname(){return window.location.pathname}get path(){var a=window.location.pathname.replace(new RegExp(["^",this.root].join("")),"").split("?").slice(0,1)[0],b=0===a.length?[]:1===a.length&&a.match(/^\//)&&a.match(/\/?/)?["/"]:a.replace(/^\//,"").replace(/\/$/,"").split("/");return {fragments:b,string:a}}get hash(){var a=window.location.hash.slice(1).split("?").slice(0,1)[0],b=0===a.length?[]:1===a.length&&a.match(/^\//)&&a.match(/\/?/)?["/"]:a.replace(/^\//,"").replace(/\/$/,"").split("/");return {fragments:b,string:a}}get parameters(){var a,b;if(window.location.href.match(/\?/)){var c=window.location.href.split("?").slice(-1).join("");a=c,b=c.split("&").reduce((a,b)=>{var c=b.split("=");return a[c[0]]=c[1],a},{});}else a="",b={};return {string:a,data:b}}get _root(){return this.root||"/"}set _root(a){this.root=a;}get _hashRouting(){return this.hashRouting||!1}set _hashRouting(a){this.hashRouting=a;}get _routes(){return this.routes}set _routes(a){this.routes=a;}get _controller(){return this.controller}set _controller(a){this.controller=a;}get location(){return {root:this.root,path:this.path,hash:this.hash,parameters:this.parameters}}matchRoute(a,b){var c=[];return a.length===b.length?c=a.reduce((a,c,d)=>{var e=b[d];return c.match(/^\:/)?a.push(!0):c===e?a.push(!0):a.push(!1),a},[]):c.push(!1),-1===c.indexOf(!1)}getRoute(a){var b=Object.entries(this.routes).reduce((a,b)=>{var[c,d]=b,e=1===c.length&&c.match(/^\//)?[c]:0===c.length?[""]:c.replace(/^\//,"").replace(/\/$/,"").split("/");return d.fragments=e,a[e.join("/")]=d,a},{});return Object.values(b).find(b=>{var c=b.fragments,d=this.hashRouting?a.hash.fragments:a.path.fragments,e=this.matchRoute(c,d);return !0===e})}popState(a){var b=this.location,c=this.getRoute(b),d={route:c,location:b};c&&(this.controller[c.callback](d),this.emit("change",{name:"change",data:d},this));}addWindowEvents(){window.on("popstate",this.popState.bind(this));}removeWindowEvents(){window.off("popstate",this.popState.bind(this));}navigate(a){window.location.href=a;}};

  var MVC$1={Events,Channels,Utils,Service,Model,Collection,View,Controller,Router};

  return MVC$1;

})));

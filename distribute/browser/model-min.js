"use strict";var MVC=MVC||{};MVC.Events=class{constructor(){}get _events(){return this.events=this.events||{},this.events}getEventCallbacks(t){return this._events[t]||{}}getEventCallbackName(t){return t.name.length?t.name:"anonymousFunction"}getEventCallbackGroup(t,e){return t[e]||[]}on(t,e){var s=this.getEventCallbacks(t),a=this.getEventCallbackName(e),i=this.getEventCallbackGroup(s,a);return i.push(e),s[a]=i,this._events[t]=s,this}off(){switch(arguments.length){case 0:delete this.events;break;case 1:var t=arguments[0];delete this._events[t];break;case 2:t=arguments[0];var e=arguments[1],s="string"==typeof e?e:this.getEventCallbackName(e);this._events[t]&&(delete this._events[t][s],0===Object.keys(this._events[t]).length&&delete this._events[t])}return this}emit(t,e){var s=Object.values(arguments),a=Object.entries(this.getEventCallbacks(t));for(var[i,r]of a)for(var h of r){h(e,...s.splice(2)||[])}return this}},MVC.Model=class extends MVC.Base{constructor(){return super(...arguments),this}get keyMap(){return["name","schema","localStorage","histiogram","services","serviceCallbacks","serviceEvents","data","dataCallbacks","dataEvents","defaults"]}get _schema(){return this._schema}set _schema(t){this.schema=t}get _isSetting(){return this.isSetting}set _isSetting(t){this.isSetting=t}get _changing(){return this.changing=this.changing||{},this.changing}get _localStorage(){return this.localStorage}set _localStorage(t){this.localStorage=t}get _defaults(){return this.defaults}set _defaults(t){this.defaults=t}get _histiogram(){return this.histiogram||{length:1}}set _histiogram(t){this.histiogram=Object.assign(this._histiogram,t)}get _history(){return this.history=this.history||[],this.history}set _history(t){Object.keys(t).length&&this._histiogram.length&&(this._history.unshift(this.parse(t)),this._history.splice(this._histiogram.length))}get _db(){var t=localStorage.getItem(this.localStorage.endpoint);return this.db=t||"{}",JSON.parse(this.db)}set _db(t){t=JSON.stringify(t),localStorage.setItem(this.localStorage.endpoint,t)}get _data(){return this.data=this.data||{},this.data}get _dataEvents(){return this.dataEvents=this.dataEvents||{},this.dataEvents}set _dataEvents(t){this.dataEvents=MVC.Utils.addPropertiesToObject(t,this._dataEvents)}get _dataCallbacks(){return this.dataCallbacks=this.dataCallbacks||{},this.dataCallbacks}set _dataCallbacks(t){this.dataCallbacks=MVC.Utils.addPropertiesToObject(t,this._dataCallbacks)}get _services(){return this.services=this.services||{},this.services}set _services(t){this.services=MVC.Utils.addPropertiesToObject(t,this._services)}get _serviceEvents(){return this.serviceEvents=this.serviceEvents||{},this.serviceEvents}set _serviceEvents(t){this.serviceEvents=MVC.Utils.addPropertiesToObject(t,this._serviceEvents)}get _serviceCallbacks(){return this.serviceCallbacks=this.serviceCallbacks||{},this.serviceCallbacks}set _serviceCallbacks(t){this.serviceCallbacks=MVC.Utils.addPropertiesToObject(t,this._serviceCallbacks)}get _enabled(){return this.enabled||!1}set _enabled(t){this.enabled=t}get(){switch(arguments.length){case 0:return this._data;case 1:var t=arguments[0];return this._data[t]}}set(){switch(this._history=this.parse(),arguments.length){case 1:this._isSetting=!0;var t=Object.entries(arguments[0]);t.forEach((e,s)=>{var[a,i]=e;s===t.length-1&&(this._isSetting=!1),this.setDataProperty(a,i)});break;case 2:var e=arguments[0],s=arguments[1];this.setDataProperty(e,s)}return this}unset(){switch(this._history=this.parse(),arguments.length){case 0:for(var t of Object.keys(this._data))this.unsetDataProperty(t);break;case 1:var e=arguments[0];this.unsetDataProperty(e)}return this}setDB(){var t=this._db;switch(arguments.length){case 1:Object.entries(arguments[0]).forEach(e=>{var[s,a]=e;t[s]=a});break;case 2:var e=arguments[0],s=arguments[1];t[e]=s}return this._db=t,this}unsetDB(){switch(arguments.length){case 0:delete this._db;break;case 1:var t=this._db;delete t[arguments[0]],this._db=t}return this}setDataProperty(t,e){if(!this._data["_".concat(t)]){var s=this;Object.defineProperties(this._data,{["_".concat(t)]:{configurable:!0,get(){return this[t]},set(e){var a=s._settings.schema;a&&a[t]?(this[t]=e,s._changing[t]=e,this.localStorage&&s.setDB(t,e)):a||(this[t]=e,s._changing[t]=e,this.localStorage&&s.setDB(t,e));var i=["set",":",t].join("");s.emit(i,{name:i,data:{key:t,value:e}},s),s._isSetting||(Object.values(s._changing).length?s.emit("set",{name:"set",data:Object.assign({},s._changing,s._data)},s):s.emit("set",{name:"set",data:s._data},s),delete s.changing)}}})}return this._data["_".concat(t)]=e,this}unsetDataProperty(t){var e=["unset",":",t].join(""),s=this._data[t];return delete this._data["_".concat(t)],delete this._data[t],this.emit(e,{name:e,data:{key:t,value:s}},this),this.emit("unset",{name:"unset",data:{key:t,value:s}},this),this}setDefaults(){var t={};this.defaults&&Object.assign(t,this.defaults),this.localStorage&&Object.assign(t,this._db),Object.keys(t)&&this.set(t)}resetServiceEvents(){return this.disableServiceEvents().enableServiceEvents()}enableServiceEvents(){this.services&&this.serviceEvents&&this.serviceCallbacks&&MVC.Utils.bindEventsToTargetObjects(this.serviceEvents,this.services,this.serviceCallbacks)}disableServiceEvents(){this.services&&this.serviceEvents&&this.serviceCallbacks&&MVC.Utils.unbindEventsFromTargetObjects(this.serviceEvents,this.services,this.serviceCallbacks)}resetDataEvents(){return this.disableDataEvents().enableDataEvents()}enableDataEvents(){this.dataEvents&&this.dataCallbacks&&MVC.Utils.bindEventsToTargetObjects(this.dataEvents,this,this.dataCallbacks)}disableDataEvents(){this.dataEvents&&this.dataCallbacks,MVC.Utils.unbindEventsFromTargetObjects(this.dataEvents,this,this.dataCallbacks)}enable(){var t=this.settings;return this.enabled||(this.setProperties(t||{},this.keyMap,{data:function(t){this.set(t)}.bind(this)}),this.enableServiceEvents(),this.enableDataEvents(),this._enabled=!0),this}disable(){var t=this.settings;return this.enabled&&(this.disableServiceEvents(),this.disableDataEvents(),this.deleteProperties(t||{},this.keyMap),this._enabled=!1),this}parse(t){return t=t||this._data||{},JSON.parse(JSON.stringify(t))}};
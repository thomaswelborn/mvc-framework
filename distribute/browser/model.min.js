(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global = global || self, global.Channels = factory());
}(this, (function () { 'use strict';

  class Events{constructor(){}get _events(){return this.events=this.events||{},this.events}getEventCallbacks(a){return this._events[a]||{}}getEventCallbackName(a){return a.name.length?a.name:"anonymousFunction"}getEventCallbackGroup(a,b){return a[b]||[]}on(a,b){var c=this.getEventCallbacks(a),d=this.getEventCallbackName(b),e=this.getEventCallbackGroup(c,d);return e.push(b),c[d]=e,this._events[a]=c,this}off(){switch(arguments.length){case 0:delete this.events;break;case 1:var a=arguments[0];delete this._events[a];break;case 2:var a=arguments[0],b=arguments[1],c="string"==typeof b?b:this.getEventCallbackName(b);this._events[a]&&(delete this._events[a][c],0===Object.keys(this._events[a]).length&&delete this._events[a]);}return this}emit(){var a=Array.from(arguments),b=a.splice(0,1)[0],c=a.splice(0,1)[0],d=a.splice(0);return Object.entries(this.getEventCallbacks(b)).forEach((a)=>{var[e,f]=a;f.forEach(a=>{a({name:b,data:c},...d);});}),this}}

  function UUID(){var a,b,c="";for(a=0;32>a;a++)b=0|16*Math.random(),(8==a||12==a||16==a||20==a)&&(c+="-"),c+=(12==a?4:16==a?8|3&b:b).toString(16);return c}

  var Model=class extends Events{constructor(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(),this.settings=a,this.options=b,this.emit("ready",{},this);}get uuid(){return this._uuid||(this._uuid=UUID()),this._uuid}get validSettings(){return ["localStorage","defaults","services","serviceEvents","serviceCallbacks"]}get bindableEventClassPropertyTypes(){return ["service"]}get settings(){return this._settings}set settings(a){this._settings=a,this.validSettings.forEach(b=>{a[b]&&(this[b]=a[b]);}),this.bindableEventClassPropertyTypes.forEach(a=>{this.toggleEvents(a,"on");});}get options(){return this._options||(this._options={}),this._options}set options(a){this._options=a;}get services(){return this._services||(this._services={}),this._services}set services(a){this._services=a;}get data(){return this._data||(this._data={}),this._data}get defaults(){return this._defaults||(this._defaults={}),this._defaults}set defaults(a){this._defaults=!0===this.localStorage.sync?0===Object.entries(this.db).length?a:this.db:a,this.set(this.defaults);}get localStorage(){return this._localStorage||{}}set localStorage(a){this._localStorage=a;}get storageContainer(){return {}}get db(){return this._db}get _db(){var a=localStorage.getItem(this.localStorage.endpoint)||JSON.stringify(this.storageContainer);return JSON.parse(a)}set _db(a){a=JSON.stringify(a),localStorage.setItem(this.localStorage.endpoint,a);}resetEvents(a){return ["off","on"].forEach(b=>{this.toggleEvents(a,b);}),this}toggleEvents(a,b){var c=a.concat("s"),d=a.concat("Events"),e=a.concat("Callbacks"),f=this[c],g=this[d],h=this[e];return f&&g&&h&&Object.entries(g).forEach((a)=>{var[c,d]=a,[e,g]=c.split(" "),i=f[e],j=h[d];if(j&&1===j.name.split(" ").length&&(j=j.bind(this)),e&&g&&i&&j)try{i[b](g,j);}catch(a){}}),this}setDB(){var a=this._db;switch(arguments.length){case 1:var b=Object.entries(arguments[0]);b.forEach((b)=>{var[c,d]=b;a[c]=d;});break;case 2:var c=arguments[0],d=arguments[1];a[c]=d;}return this._db=a,this}unsetDB(){switch(arguments.length){case 0:delete this._db;break;case 1:var a=this._db,b=arguments[0];delete a[b],this._db=a;}return this}setDataProperty(a,b,c){return this.data[a]||Object.defineProperties(this.data,{["_".concat(a)]:{configurable:!0,writable:!0,enumerable:!1},[a]:{configurable:!0,enumerable:!0,get(){return this["_".concat(a)]},set(b){this["_".concat(a)]=b;}}}),this.data[a]=b,("undefined"==typeof c||!1===c)&&this.emit("set".concat(":",a),{key:a,value:b},this),this}unsetDataProperty(a,b){return this.data[a]&&delete this.data[a],("boolean"==typeof b&&!1===b||"undefined"==typeof b)&&this.emit("unset".concat(":",arguments[0]),this),this}get(){return arguments[0]?this.data[arguments[0]]:Object.entries(this.data).reduce((a,b)=>{var[c,d]=b;return a[c]=d,a},{})}set(){var a,b,c;return 3===arguments.length?(a=arguments[0],b=arguments[1],c=arguments[2],this.setDataProperty(a,b,c),this.localStorage.endpoint&&this.setDB(arguments[0],arguments[1])):2===arguments.length?("object"==typeof arguments[0]&&"boolean"==typeof arguments[1]?(c=arguments[1],Object.entries(arguments[0]).forEach((a)=>{var[b,d]=a;this.setDataProperty(b,d,c);})):this.setDataProperty(arguments[0],arguments[1]),this.localStorage.endpoint&&this.setDB(arguments[0],arguments[1])):1===arguments.length&&!Array.isArray(arguments[0])&&"object"==typeof arguments[0]&&Object.entries(arguments[0]).forEach((a)=>{var[b,c]=a;this.setDataProperty(b,c),this.localStorage.endpoint&&this.setDB(b,c);}),c||this.emit("set",this.data,this),this}unset(){var a;return 2===arguments.length?(a=arguments[1],this.unsetDataProperty(arguments[0],a)):1===arguments.length?"boolean"==typeof arguments[0]&&(a=arguments[0],Object.keys(this.data).forEach(b=>{this.unsetDataProperty(b,a);})):Object.keys(this.data).forEach(a=>{this.unsetDataProperty(a);}),this.localStorage.endpoint&&this.unsetDB(key),this.emit("unset",this),this}parse(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.data;return Object.entries(a).reduce((a,b)=>{var[c,d]=b;return a[c]=d instanceof Model?d.parse():d,a},{})}};

  return Model;

})));

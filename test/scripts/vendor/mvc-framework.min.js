class Events{constructor(){this.events={}}on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){var s=this.events[t];if(void 0!==s&&0!==s.length){for(var i=Object.entries(s).filter(function(t,s){return"string"==typeof e&&e===t[1].name||"function"==typeof e&&e.name===t[1].name}.bind(this)),n=i.length;n>0;n--)s.splice(i[n-1][0],1);0===s.length&&delete this.events[t]}}trigger(t,e){try{this.events[t].forEach(function(t){t(e)})}catch(t){}}}class AJAX{constructor(t,e,s){return this.responseTypes=["","arraybuffer","blob","document","json","text"],this.defaultContentType={"Content-Type":"application/json"},this.defaultResponseType="json",this.type=t,this.url=e,this.settings=s||{},this.data=this.settings.data||null,new Promise(function(t,e){this.xhr=new XMLHttpRequest,this.xhr.open(this.type,this.url),this.setResponseType(this.xhr,this.settings.responseType||this.defaultResponseType),this.setHeaders(this.xhr,this.settings.headers||[this.defaultContentType]),this.xhr.onload=t,this.xhr.onerror=e,this.xhr.send(this.data)}.bind(this))}setResponseType(t,e){t.responseType=this.responseTypes.find(function(t){return t===e})||""}setHeaders(t,e){e.forEach(function(e){t.setRequestHeader(Object.keys(e)[0],Object.values(e)[0])})}}class Model extends Events{constructor(t){super(),Object.assign(this,t,{settings:t}),"object"==typeof this.data&&this.setAll(this.data),"function"==typeof this.initialize&&this.initialize()}fetch(t,e){return new AJAX("GET",e||this.url,t||{})}add(t,e){return new AJAX("POST",e||this.url,t||{})}update(t,e){return new AJAX("PUT",e||this.url,t||{})}remove(t,e){return new AJAX("DELETE",e||this.url,t||{})}setAll(data){if("object"==typeof data)if(this.data=eval(Array("new"," ",data.constructor.name,"()").join("")),this._data=data,Array.isArray(data))for(var key in data)"Model"!==data[key].constructor.name&&(data[key]=new Model({data:data[key]}),data[key].on("set",function(t){this.trigger("set",t)}.bind(this))),this.set(this.data.length,data[key]);else for(var key in data)this.set(key,data[key])}set(t,e){void 0===this.data[t]&&this.setProperty(this,t,e),"number"==typeof t&&"Model"!==e.constructor.name&&(e=new Model({data:e})),this.data[t]=e}setProperty(t,e,s){Object.defineProperty(t.data,e,{get:()=>t._data[e],set(s){var i=Object.assign({},t._data);t._data[e]=s,t.trigger("set",{original:i,current:t._data}),t.trigger(String.prototype.concat("set",":",e),{original:i[e],current:t._data[e]})}})}unsetAll(){Object.entries(this._data).forEach(function(t){this.unset(t[0])}.bind(this))}unset(t){void 0!==this.data[t]&&(delete this.data[t],delete this._data[t],this.trigger(String.prototype.concat("unset",":",t),this._data))}get(t){return t?this.data[t]:this._data}parse(){var data=eval(Array("new"," ",this.data.constructor.name,"()").join(""));for(var key in this._data)this._data[key]instanceof Model?data[key]=this._data[key].parse():data[key]=this._data[key];return JSON.parse(JSON.stringify(data))}}class View extends Events{constructor(t){super(),Object.assign(this,t,{settings:t}),this.setElement(),this.setEvents(),"function"==typeof this.initialize&&this.initialize()}setElement(){switch(typeof this.element){case"undefined":this.element=document.createElement(this.elementName||"div");break;case"string":this.element=document.querySelector(this.element)}"object"==typeof this.attributes&&this.setElementAttributes(this.element,this.attributes)}setElementAttributes(t,e){for(var s in e)t.setAttribute(s,e[s])}setEvents(){this.on("render",this.setElements.bind(this))}setElements(){this.elements=this.elements||{},Object.entries(this.elements).forEach(function(t){this.elements[t[0]]=this.element.querySelectorAll(t[1])}.bind(this)),this.bindEvents(this.elements,this.elementEvents)}render(t){return this.element.innerHTML="","function"==typeof this.template&&this.element.append(this.template(t||{})),this.trigger("render",this),this}bindEvents(t,e){Object.entries(e).forEach(function(e){e[0]=e[0].split(" ");var s=e[0][0].split(","),i=e[0][1].split(","),n=e[1];Object.entries(s).forEach(function(e){e=e[1].replace("@",""),Object.entries(i).forEach(function(s){s=s[1],n="function"==typeof n?n:this[n];var i=String.prototype.concat(this.constructor.name.toLowerCase(),":","event");t[e].forEach(function(t){t.addEventListener(s,function(t){n(t),this.trigger(i,this)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))}}class Controller extends Events{constructor(t){super(),Object.assign(this,t,{settings:t}),void 0!==this.views&&void 0!==this.viewEvents&&this.bindEvents(this.views,this.viewEvents),void 0!==this.models&&void 0!==this.modelEvents&&this.bindEvents(this.models,this.modelEvents),void 0!==this.controllers&&void 0!==this.controllerEvents&&this.bindEvents(this.controllers,this.controllerEvents),"function"==typeof this.initialize&&this.initialize()}bindEvents(t,e){Object.entries(e).forEach(function(e){e[0]=e[0].split(" ");var s=e[0][0].split(","),i=e[0][1].split(","),n=e[1];Object.entries(s).forEach(function(e){e=e[1].replace("@",""),Object.entries(i).forEach(function(s){s=s[1],n="function"==typeof n?n:this[n];var i=String.prototype.concat(this.constructor.name.toLowerCase(),":","event");t[e].on(s,function(t){n(t),this.trigger(i,this)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}}class Router extends Events{constructor(t){super(),Object.assign(this,t,{settings:t}),this.setRoutes(this.routes,this.controllers),this.setEvents(),this.start(),"function"==typeof this.initialize&&this.initialize()}start(){""===this.getRoute()?window.location.hash="/":window.dispatchEvent(new Event("hashchange"))}setRoutes(t,e){for(var s in t)this.routes[s]=e[t[s]]}setEvents(){window.addEventListener("hashchange",this.onHashChange.bind(this))}getRoute(){return String(window.location.hash).split("#").pop()}onHashChange(t){var e=this.getRoute();try{this.routes[e](t),this.trigger("navigate",t)}catch(t){}}navigate(t){window.location.hash=t}}